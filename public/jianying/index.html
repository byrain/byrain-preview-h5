<!doctype html>
<html lang="zh-CN">

<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Web 版 B 系统（剪映草稿生成）</title>
  <link rel="stylesheet" href="./style.css" />
</head>

<body>
  <div class="wrap">
    <h1>Web 版 B 系统（剪映草稿生成）</h1>

    <!-- ① 选择并授权剪映目录 -->
    <div class="card">
      <div class="card-h">① 剪映目录</div>
      <div class="card-b">
        <div class="row">
          <button id="pickJY" class="btn btn-select">选择剪映目录</button>
          <div class="right toolbar">
            <button id="resetAll" class="btn danger">清除记忆并重选</button>
          </div>
        </div>

        <div class="spacer"></div>

        <!-- 动态提示：未选择 / 已选择 -->
        <div id="jyHintNotSelected" class="callout warn">
          还没有选择剪映草稿根目录。请点击“选择剪映目录”，并在弹出的系统对话框中授权写入。
        </div>
        <div id="jyHintSelected" class="callout ok hidden">
          已选择并授权写入。你可以直接粘贴加密字符串并开始处理。如需更换目录，可点“重新选择剪映目录”。
        </div>

        <div class="spacer"></div>

        <div class="field">
          <label class="muted">已选择（只读展示）</label>
          <div id="jyPathDisplay" class="dir-display muted">尚未选择</div>
        </div>

        <div class="spacer"></div>
        <div class="note muted">
          不知道剪映草稿目录在哪？一般在
          <code>（用户目录）/Movies/JianyingPro/User Data/Projects/com.lveditor.draft</code>。<br />
          点击上面的“选择剪映目录”，授权后我们会在其中新建一个以时间戳命名的草稿文件夹。
        </div>
      </div>
    </div>

    <!-- ② 输入与配置 -->
    <div class="card block-gap-lg">
      <div class="card-h">② 输入与配置</div>
      <div class="card-b">
        <div class="field">
          <label>加密字符串（未解码）</label>
          <textarea id="encodedInput" placeholder="把 A 系统输出的加密字符串粘贴到这里"></textarea>
        </div>

        <div class="block-gap field">
          <label>解密密钥</label>
          <input id="secretKey" type="password" placeholder="（必填）" required>
        </div>

        <div class="block-gap grid2">
          <div class="field">
            <label>主题</label>
            <select id="theme">
              <option value="default">默认</option>
              <option value="dark">暗色</option>
            </select>
          </div>
          <div class="field">
            <label>画幅</label>
            <select id="aspect">
              <option value="1080x1920">1080 × 1920</option>
              <option value="1200x1600">1200 × 1600</option>
            </select>
          </div>
        </div>

        <div class="block-gap field" style="max-width:340px">
          <label>字幕每片最大字数（建议 12–16）</label>
          <input id="maxChars" type="number" min="6" max="40" step="1" value="14" />
          <div class="muted">用于过长字幕的自动切分，切分后会按字符占比分配时长，并与音频严格对齐。</div>
        </div>

        <div class="block-gap toolbar">
          <button id="startBtn" class="btn primary">开始处理</button>
          <div id="runStatus" class="muted"></div>
        </div>
      </div>
    </div>

    <!-- ③ 文件状态 -->
    <div id="filesCard" class="card block-gap-lg hidden">
      <div class="card-h">③ 文件状态</div>
      <div class="card-b">
        <table id="filesTable">
          <thead>
            <tr>
              <th style="width:90px">类型</th>
              <th>名称</th>
              <th style="width:80px">时长</th>
              <th style="width:120px">小预览</th>
              <th style="width:120px">状态</th>
            </tr>
          </thead>
          <tbody id="filesTbody"></tbody>
        </table>
        <div id="errorBox" class="error block-gap"></div>
      </div>
    </div>

    <!-- ④ 生成结果 -->
    <div id="resultCard" class="card block-gap-lg hidden">
      <div class="card-h">④ 生成结果</div>
      <div class="card-b">
        <div class="row">
          <div class="field" style="max-width:360px">
            <label>时间戳文件夹</label>
            <input id="tsOutput" type="text" readonly>
          </div>
          <div class="field">
            <label>结果摘要</label>
            <div id="resultSummary" class="note muted">未开始</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 图片预览 Modal -->
  <div id="imgModal" class="modal" role="dialog" aria-modal="true">
    <div class="modal-inner"><img id="imgPreview" alt="预览" /></div>
  </div>

  <!-- 普通脚本，避免 file:// 下 ES Module 的 CORS 限制 -->
  <script src="./app.js"></script>
</body>

</html>